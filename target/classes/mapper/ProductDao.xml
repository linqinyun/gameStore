<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lin.gamestroe.dao.ProductDao">
    <resultMap id="productMap" type="com.lin.gamestroe.entity.Product">
        <id property="productId" column="product_id"/>
        <result property="name" column="name"/>
        <result property="normalPrice" column="normal_price"/>
        <result property="promotionPrice" column="promotion_price"/>
        <result property="productDesc" column="product_desc"/>
        <result property="imgPath" column="img_path"/>
        <result property="total" column="total"/>
        <result property="priority" column="priority"/>
        <result property="isActive" column="is_active"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <association property="productCategory" column="product_category_id"
                     javaType="com.lin.gamestroe.entity.ProductCategory">
            <id property="categoryId" column="gpc_category_id"/>
            <result property="name" column="gpc_name"/>
        </association>
    </resultMap>
    <select id="queryProductList" resultMap="productMap">
        select product_id,
               product_category_id,
               gp.name,
               normal_price,
               promotion_price,
               product_desc,
               img_path,
               total,
               priority,
               is_active,
               gp.create_time,
               gp.update_time,
               gpc.name gpc_name,
               gpc.category_id gpc_category_id
        from gs_product gp,gs_product_category gpc
        where gp.product_category_id=gpc.category_id
        order by priority desc;
    </select>
    <select id="queryproductCount" resultType="int">
        select count(*)
        from gs_product;
    </select>
    <insert id="insertProduct" parameterType="com.lin.gamestroe.entity.Product" useGeneratedKeys="true"
            keyProperty="productId" keyColumn="product_id">
        insert into gs_product(product_id, product_category_id, name, normal_price, promotion_price, product_desc,
                               img_path, total, priority, is_active, create_time, update_time)
        VALUES (#{productId}, #{productCategory.categoryId}, #{name}, #{normalPrice}, #{promotionPrice}, #{productDesc},
                #{imgPath}, #{total}, #{priority}, #{isActive}, #{createTime}, #{updateTime})

    </insert>
    <update id="updateProduct" parameterType="com.lin.gamestroe.entity.Product" keyColumn="product_id"
            useGeneratedKeys="true">
        update gs_product
        <set>
            <if test="name != null">name=#{name},</if>
            <if test="normalPrice != null">normal_price=#{normalPrice},</if>
            <if test="promotionPrice != null">promotion_price=#{promotionPrice},</if>
            <if test="productDesc != null">product_desc=#{productDesc},</if>
            <if test="imgPath != null">img_path=#{imgPath},</if>
            <if test="total != null">total=#{total},</if>
            <if test="priority != null">priority=#{priority},</if>
            <if test="isActive !=null">is_active=#{isActive},</if>
            <if test="updateTime != null">update_time=#{updateTime},</if>
            <if test="productCategory != null and productCategory.categoryId != null">
                product_category_id = #{productCategory.categoryId}
            </if>
        </set>
        where product_id = #{productId}
    </update>
    <delete id="deleteProduct">
        delete
        from gs_product
        where product_id = #{productId}
    </delete>
</mapper>